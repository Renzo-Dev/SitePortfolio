<template>
	<section id="about" class="about section">
		<div class="container">
			<div class="about__grid">
				<!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å - —Ñ–æ—Ç–æ —Å 3D —ç—Ñ—Ñ–µ–∫—Ç–æ–º -->
				<div
					ref="imageWrapper"
					class="about__image-wrapper"
					@mousemove="handleImageHover"
					@mouseleave="resetImageHover"
				>
					<div class="about__image-glow" />
					<div ref="imageContainer" class="about__image-container">
						<img
							src="/images/photo-1571171637578-41bc2dd41cd2.jpg"
							alt="Dan Koshevoy"
							class="about__image"
							width="600"
							height="800"
							loading="lazy"
						/>
					</div>
				</div>

				<!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å - –∫–æ–Ω—Ç–µ–Ω—Ç -->
				<div class="about__content">
					<h2 ref="titleRef" class="about__title">
						<Icon name="ph:user-circle-duotone" size="32" />
						–û–±–æ –º–Ω–µ
					</h2>
					<p ref="textRef" class="about__text">
						–Ø ‚Äî —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–ª–Ω–æ–≥–æ —Å—Ç–µ–∫–∞ —Å –æ–ø—ã—Ç–æ–º –±–æ–ª–µ–µ
						<strong>3 –ª–µ—Ç –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏</strong>. –õ—é–±–ª—é –ø—Ä–æ–¥—É–º—ã–≤–∞—Ç—å
						–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å —á–∏—Å—Ç—ã–π, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π –∫–æ–¥.
					</p>

					<!-- –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã -->
					<div ref="strengthsRef" class="about__strengths">
						<h3 class="about__subtitle">
							<Icon name="ph:star-duotone" size="24" />
							–ú–æ–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã
						</h3>
						<ul class="about__list">
							<li
								v-for="(strength, index) in strengths"
								:key="index"
								class="about__list-item"
								:style="{ '--item-index': index }"
							>
								<Icon :name="strength.icon" size="20" />
								<span>{{ strength.text }}</span>
							</li>
						</ul>
					</div>

					<!-- –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ -->
					<div ref="techRef" class="about__tech">
						<h3 class="about__subtitle">
							<Icon name="ph:code-duotone" size="24" />
							–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
						</h3>
						<div class="about__tech-grid">
							<Badge v-for="(tech, index) in technologies" :key="index">
								{{ tech }}
							</Badge>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
</template>

<script setup lang="ts">
import Badge from '~/components/ui/Badge.vue'

const strengths = [
	{ icon: 'ph:strategy-duotone', text: '–°–∏—Å—Ç–µ–º–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –ø—Ä–æ–µ–∫—Ç–∞–º' },
	{ icon: 'ph:magnifying-glass-duotone', text: '–í–Ω–∏–º–∞–Ω–∏–µ –∫ –¥–µ—Ç–∞–ª—è–º' },
	{ icon: 'ph:gauge-duotone', text: '–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏' },
	{
		icon: 'ph:stack-duotone',
		text: '–£–º–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º, —Ç–∞–∫ –∏ —Å –±—ç–∫–µ–Ω–¥–æ–º',
	},
]

const technologies = [
	'Vue 3',
	'Nuxt 4',
	'Laravel',
	'TypeScript',
	'Docker',
	'Redis',
	'MySQL',
	'Nginx',
	'TailwindCSS',
	'Pinia',
]

// Refs –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
const imageWrapper = ref<HTMLElement>()
const imageContainer = ref<HTMLElement>()
const titleRef = ref<HTMLElement>()
const textRef = ref<HTMLElement>()
const strengthsRef = ref<HTMLElement>()
const techRef = ref<HTMLElement>()

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
const isMobile = () => {
	return window.innerWidth <= 768 || 'ontouchstart' in window
}

// 3D —ç—Ñ—Ñ–µ–∫—Ç –¥–ª—è —Ñ–æ—Ç–æ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –º—ã—à–∏
const handleImageHover = (event: MouseEvent) => {
	if (!imageWrapper.value || !imageContainer.value) return

	// –û—Ç–∫–ª—é—á–∞–µ–º 3D —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
	if (isMobile()) {
		console.log('üì± Mobile detected - 3D effect disabled')
		return
	}

	const rect = imageWrapper.value.getBoundingClientRect()
	const x = event.clientX - rect.left
	const y = event.clientY - rect.top

	const centerX = rect.width / 2
	const centerY = rect.height / 2

	const rotateX = ((y - centerY) / centerY) * -10 // max 10deg
	const rotateY = ((x - centerX) / centerX) * 10 // max 10deg

	// –ü—Ä–∏–º–µ–Ω—è–µ–º transform –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É (–Ω–µ –∫ wrapper —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π)
	imageContainer.value.style.transition = 'transform 0.1s ease-out'
	imageContainer.value.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(1.05, 1.05, 1.05)`

	console.log('üéØ 3D effect active:', {
		rotateX: rotateX.toFixed(1),
		rotateY: rotateY.toFixed(1),
	})
}

const resetImageHover = () => {
	if (!imageContainer.value) return

	// –û—Ç–∫–ª—é—á–∞–µ–º —Å–±—Ä–æ—Å 3D —ç—Ñ—Ñ–µ–∫—Ç–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
	if (isMobile()) {
		console.log('üì± Mobile detected - 3D reset disabled')
		return
	}

	// –ü–ª–∞–≤–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ
	imageContainer.value.style.transition =
		'transform 0.6s cubic-bezier(0.16, 1, 0.3, 1)'
	imageContainer.value.style.transform =
		'perspective(1000px) rotateX(0deg) rotateY(0deg) scale3d(1, 1, 1)'

	console.log('üîÑ 3D effect reset - —Ñ–æ—Ç–æ –≤–µ—Ä–Ω—É–ª–æ—Å—å –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ')
}

// Scroll reveal –∞–Ω–∏–º–∞—Ü–∏–∏
onMounted(() => {
	// –ò—Å–ø–æ–ª—å–∑—É–µ–º Intersection Observer –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
	const observerOptions = {
		threshold: 0.2,
		rootMargin: '0px 0px -100px 0px',
	}

	const observer = new IntersectionObserver((entries) => {
		entries.forEach((entry) => {
			if (entry.isIntersecting) {
				entry.target.classList.add('is-visible')
				console.log('‚úì Element revealed:', entry.target.className)
			}
		})
	}, observerOptions)

	// –ù–∞–±–ª—é–¥–∞–µ–º –∑–∞ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
	if (imageWrapper.value) {
		observer.observe(imageWrapper.value)
		console.log('‚úì Observing image wrapper')
	}
	if (titleRef.value) observer.observe(titleRef.value)
	if (textRef.value) observer.observe(textRef.value)
	if (strengthsRef.value) observer.observe(strengthsRef.value)
	if (techRef.value) observer.observe(techRef.value)

	// Cleanup
	onUnmounted(() => {
		observer.disconnect()
	})
})
</script>

<style scoped lang="scss">
@use '~/assets/styles/components/about-section';
</style>
